<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DBSystem Documentation</title>
    <link rel="stylesheet" href="css/bulma.min.css">
    <style>
        .is-sticky {
            padding-top: 1rem;
            position: -webkit-sticky;
            position: sticky;
            top: 0;
        }
    </style>
</head>
<body>
<section class="hero is-link">
    <div class="hero-body">
        <div class="container has-text-centered">
            <h1 class="title">
                DBSystem
            </h1>
            <h2 class="subtitle">
                Documentation
            </h2>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="columns">
            <div class="column is-3-desktop">
                <aside class="menu is-sticky">
                    <ul class="menu-list">
                        <li><a href="#preface">Preface</a></li>
                        <li><a href="#installation">Installation</a></li>
                        <li><a href="#update">Updating</a></li>
                        <li><a href="#databases">Databases</a></li>
                        <li><a href="#destinations">Destinations</a></li>
                        <li><a href="#tasks">Tasks</a></li>
                        <li><a href="#backups">Backups</a></li>
                        <li><a href="#settings">Settings</a></li>
                        <li><a href="#faqs">FAQs</a></li>
                        <li><a href="#development">Development</a></li>
                        <li><a href="#changelog">Changelog</a></li>
                    </ul>
                </aside>
            </div>
            <div class="column is-9-desktop">
                <article class="message is-primary">
                    <div class="message-body">
                        Thanks for purchasing <strong>DBSystem</strong>.
                        For any question or issues contact the author through his <a href="https://codecanyon.net/user/manrix" target="_blank">codecanyon page</a>.
                    </div>
                </article>
                <section>
                    <h3 id="preface" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#preface">#</a> Preface
                    </h3>
                    <h4 class="subtitle">
                        An introduction to DBSystem.
                    </h4>
                    <div class="content">
                        <p>DBSystem aims to keep the management of your website backups in one place.</p>
                        <h5>Main features</h5>
                        <ul>
                            <li>MySql, Postgres and Sqlite databases backup</li>
                            <li>Files and directories backup</li>
                            <li>A task system to automate the backup process</li>
                            <li>Ftp, Google Drive and Dropbox cloud destinations</li>
                            <li>Users management</li>
                            <li>Backups management</li>
                            <li>Databases management</li>
                            <li>Destinations management</li>
                            <li>Activity logging</li>
                            <li>Sensible data encryption</li>
                        </ul>
                        <h5>Requirements</h5>
                        <ul>
                            <li>PHP >= 7.0.0</li>
                            <li>OpenSSL PHP Extension</li>
                            <li>PDO PHP Extension</li>
                            <li>Mbstring PHP Extension</li>
                            <li>Tokenizer PHP Extension</li>
                            <li>XML PHP Extension</li>
                            <li>Curl PHP Extension</li>
                            <li>Zip PHP Extension</li>
                            <li>Phar PHP Extension</li>
                            <li>Zlib PHP Extension</li>
                            <li>proc_open PHP function</li>
                            <li>mysqldump for mysql database backups *</li>
                            <li>pg_dump for postgress database backups *</li>
                            <li>sqlite3 for sqlite database backups *</li>
                            <li>Ability to set cron jobs</li>
                            <li>Gzip</li>
                        </ul>
                        <i>[*] optional requirements depending on which database you want to backup</i>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="installation" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#installation">#</a> Installation
                    </h3>
                    <h4 class="subtitle">
                        Installation step by step.
                    </h4>
                    <div class="content">
                        <ol>
                            <li>
                                Create a database for the application. It can be a mysql, postgresql or sqlite database.
                            </li>
                            <li>
                                Extract the content of <strong>upload.zip</strong> archive and upload the content in the directory where you want to install the app.
                            </li>
                            <li>
                                Set permissions to <strong class="has-text-success">775</strong> for the following application directories:
                                <ul>
                                    <li>storage/framework/</li>
                                    <li>storage/logs/</li>
                                    <li>bootstrap/cache/</li>
                                    <li>storage/backups/</li>
                                    <li>storage/dbsystem/</li>
                                </ul>
                            </li>
                            <li>
                                Set the <code>public</code> folder as your server root or upload the content of dbsystem <code>public</code>
                                folder to your public folder (usually the root folder is <i>public_html</i>) or in a sub-directory.
                                <article class="message is-warning">
                                    <div class="message-body">
                                        For security reasons you should place the app outside of accessible space. Otherwise refer to
                                        <a href="#faqs">faqs</a> to know what to do.
                                    </div>
                                </article>
                                <p>An example structure placing the ap in a sub domain:</p>
                                <img src="img/structure.png" alt="structure">
                            </li>
                            <li>
                                Now navigate to your app url <code>/install</code>. You should see the installation interface.
                                <ol>
                                    <li>Compile the required fields.
                                        <br>
                                        You can choose a folder for your backups or the default one in storage will be used.
                                        <br>
                                        Specify your timezone for correct formatting of dates.
                                    </li>
                                    <li>Insert the admin user account data.</li>
                                    <li>Press <b>Install</b> button to install.</li>
                                    <li>Remove the <code>install</code> folder if all went well.</li>
                                </ol>
                            </li>
                            <li>
                                Add a cron job to execute the command <code>php artisan schedule:run</code> every minute.
                                This command will execute the application and backups cleanups.
                                <br>
                                The cleanups can also be executed using artisan console with <code>php artisan dbsystem:cleanup</code> and <code>php artisan backups:cleanup</code>.
                                <br>
                                If your host doesn't allow you to run php commands from cron jobs, refer to <a href="#faqs">faqs</a> for a possible solution.
                            </li>
                        </ol>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="update" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#update">#</a> Updating
                    </h3>
                    <h4 class="subtitle">
                        The update process.
                    </h4>
                    <article class="message is-info">
                        <div class="message-body">
                            During the update process a backup of old important files are stored in <code>storage/old/</code> directory.
                        </div>
                    </article>
                    <div class="content">
                        <ol>
                            <li>Extract the content of <b>upload.zip</b> archive and upload the files to your app folder overwriting existing ones.</li>
                            <li>Login to dbsystem and click on "Update Now" button on top notification or navigate to your app url <code>/update</code>.</li>
                            <li>Click on the <b>Update</b> button.</li>
                            <li><span class="has-text-danger"><b>!</b></span> Check if <i>install</i> folder is present in your public directory and remove it.</li>
                        </ol>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="databases" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#databases">#</a> Databases
                    </h3>
                    <h4 class="subtitle">
                        An introduction to databases management.
                    </h4>
                    <div class="content">
                        <p>The application supports 3 types of databases: mysql, postgresql and sqlite. <br>
                            To backup these database type you need their shell commands on your server: <b>mysqldump</b>, <b>pg_dump</b>, <b>sqlite3</b>.</p>
                        <p>When you add a database you've to specify the database name, the host and the database user.<br>
                            The port can be left empty if is the default of the database type.</p>
                        <p>The default host is <code>localhost</code>. You can specify a remote host to backup a remote database.
                            But remember to allow the remote connection for that database on the remote server.</p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="destinations" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#destinations">#</a> Destinations
                    </h3>
                    <h4 class="subtitle">
                        An introduction to destinations management.
                    </h4>
                    <div class="content">
                        <p>The application supports 4 types of  destinations: <b>google drive</b>, <b>dropbox</b>, <b>ftp</b> and another <b>local</b> directory.</p>
                        <p>To use google drive as destination you've to get a <b>client id</b>, a <b>client secret</b> and a <b>refresh token</b>. <br>
                            Sign in with your google account to <a href="https://console.developers.google.com/">google console</a> and follow these steps:</p>
                        <ul>
                            <li>
                                <a target="_blank" href="img/google-drive-step1.png">
                                    client id and secret
                                </a>
                            </li>
                            <li>
                                <a target="_blank" href="img/google-drive-step2.png">
                                    refresh token
                                </a>
                            </li>
                        </ul>
                        <p>To use dropbox destinations you need a token:</p>
                        <ul>
                            <li>Sign in with your dropbox account at <a target="_blank" href="https://www.dropbox.com/developers">https://www.dropbox.com/developers</a></li>
                            <li>Go to <i>My Apps</i> and <i>Create</i> an app</li>
                            <li>Scroll down and click the <i>Generate</i> button to get the token</li>
                        </ul>
                        <p>FTP and local destinations are straightforward to configure.</p>
                        <p>For each destination you can specify a <i>"root"</i>. This root is the folder used in the transfer.</p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="tasks" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#tasks">#</a> Tasks
                    </h3>
                    <h4 class="subtitle">
                        An introduction to DBSystem tasks.
                    </h4>
                    <div class="content">
                        <p>The tasks are the core of the application. They allow you to automate your backups with several configurable options.</p>
                        <img src="img/task.png" alt="task">
                        <ol>
                            <li>
                                The task name is required and is used to easily identify and search for it.
                            </li>
                            <li>
                                The backup name is the name the task will give to the backup file. By default a timestamp will be added to make it unique.
                                <u>Removing the timestamp can make the task fail if a backup with the same name is already in the database</u>.
                            </li>
                            <li>
                                You can also select the compression type between tar and zip. This is the compression used to merge the backups in a single archive.
                                Theoretically at this point the archives should be already compressed so <i>tar</i> is better because faster.
                            </li>
                            <li>
                                The task databases are the databases which will be dumped by the task. You can add any of the databases you previous inserted.
                                For each entry you can specify the options and the tables to include.
                            </li>
                            <li>
                                The task files are the files and directories which will be dumped by the task. Be sure to specify existing paths or the task can fail.
                                <br>
                                In the same way you can add files and directories to exclude from the backup. In this case you can use regular expressions or patterns (if shell is used) to exclude them.
                                Ex. <code>^.*\.(jpg|jpeg|png|gif)$</code> will exclude all jpg, jpeg, png and gif files from any path.
                                Refer to <a href="http://php.net/manual/en/function.preg-match.php">php documentation</a> for more information.
                                <article class="message is-warning">
                                    <div class="message-body">
                                        Beware that all paths will be resolved starting from your app root.
                                        If you want to backup files outside it, you've to specify paths with <code>../</code> to walk outside the app.
                                    </div>
                                </article>
                                Alternately to use php zip and phar classes, you can use zip and tar shell commands if you've them on your server.
                                <br>
                                The main difference is in speed. Shell commands are generally faster than php.
                                Another difference is the exclusions should be patterns and not regular expressions.
                                For more info refer to <i>zip</i> and <i>tar</i> shell documentation.
                            </li>
                            <li>
                                The task destinations are the destinations where you want the backup to be transferred.
                                You can select one of the destinations previously added.
                                <br>
                                When adding a destination you can specify a path. This path will overwrite the default root path of that destination.
                                <br>
                                You can choose to not store the backup locally but only on one of destinations using the option <i>Don't save locally</i>.
                                In this case an alternative destination is always required.
                                <br>
                                Optionally you can send the backup as an attachment to an email address.
                            </li>
                        </ol>
                        <h5>Task execution</h5>
                        <p>When a task is created, an unique token will be generated. This token is necessary to run the task from outside the application using cron jobs.
                            To view the token and full url to run the task, open the task overview.</p>
                        <img src="img/task-url.png" alt="Task url">
                        <p>This is the url you've to call using cron jobs to run the task. <u>If the task is disabled, it will not run</u>.</p>
                        <article class="message is-info">
                            <div class="message-body">
                                If you execute the task manually as logged user, the task will always run.
                            </div>
                        </article>
                        <p>Tasks can also be executed using the artisan console command: <br>
                        <code>php artisan task:run task_id</code>
                        </p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="backups" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#backups">#</a> Backups
                    </h3>
                    <h4 class="subtitle">
                        An introduction to backups management.
                    </h4>
                    <div class="content">
                        <h5>Backups list</h5>
                        <p>
                            The backups table gives you the main information for each backup: file name, creation date, type, locations and size.
                            <br>
                            Clicking on the backup name you can download it, if it's stored locally.
                        </p>
                        <h5>Backup transfer</h5>
                        <img src="img/backups-transfer.png" alt="backups-transfer">
                        <p>
                            Using this interface you can transfer the backup to one of saved destinations.
                            <br>
                            Optionally you can add that destination to the other destinations associated with the backup.
                        </p>
                        <h5>Backup restore</h5>
                        <img src="img/backups-restore.png" alt="backups-restore">
                        <p>
                            If the backup was created by dbsystem, it will contain a <code>manifest.json</code> file.
                            This file contains information about the paths of backups inside the archive.
                            <br>
                            This way the application is able to automatically locate the backups inside the archive.
                        </p>
                        <h5>Backup deletion</h5>
                        <p>
                            When you delete a single backup you can choose from which destination you want it to be deleted.
                            <br>
                            Instead the mass deletion will remove it from any destination without the possibility to choose.
                        </p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="settings" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#settings">#</a> Settings
                    </h3>
                    <h4 class="subtitle">
                        Application settings.
                    </h4>
                    <div class="content">
                        <p>You can open the settings using the gog icon on top right of navbar.</p>
                        <h5>Backups</h5>
                        <p>These settings will be used by the cleanup system.
                            <br>
                            <b>Max number of backups</b>: is the max number of backups to keep. Set to 0 for unlimited backups.
                            <br>
                            <b>Delete backups older than</b>: if set all backups older than specified days will be removed. Set to 0 to disable it.
                        </p>
                        <h5>Tasks</h5>
                        <p><b>Max execution time and memory limit</b>: they refer to the php.ini homologous settings
                            and will be used by the task system when executing a task to prevent out of memory and timeouts.
                            They will be set using <code>ini_set</code> php function. So if your host doesn't allow its use, these settings will not be considered.
                            <br>
                            <b>Delete logs older than</b>: task logs older than specified days will be removed by the cleanup system.
                        </p>
                        <h5>Security</h5>
                        <p><b>Secure token</b>: a secure password to call the scheduler from a url if you can't run the artisan command from cron jobs. Look at
                            <a href="#faqs">faqs</a> for a better understanding.</p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="faqs" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#faqs">#</a> FAQs
                    </h3>
                    <h4 class="subtitle">
                        Frequently asked questions.
                    </h4>
                    <div class="content">
                        <dl>
                            <dt><h5>I want to place the app in the same folder where i access it.</h5></dt>
                            <dd>
                                <article class="message is-warning">
                                    <div class="message-body">
                                        Always place the app outside of accessible space if you can, this will make it more secure.
                                    </div>
                                </article>
                                <ol>
                                    <li>
                                        Open the file <code>index.php</code> and edit the line <strong>24</strong> <code>require __DIR__.'/../vendor/autoload.php';</code>
                                        with the correct path, ex. <code>require __DIR__.'/vendor/autoload.php';</code> for same folder.
                                    </li>
                                    <li>
                                        Do the same with the line <strong>28</strong> <code>$app = require_once __DIR__.'/../bootstrap/app.php';</code>.
                                    </li>
                                    <li>
                                        Setup your web server to block direct access to dot files (ex. .env) and other important folders, specially the backups folder.
                                        <br>
                                        On apache you can achieve it using this code in <i>.htaccess</i>
                                        <pre>Deny from all</pre>
                                    </li>
                                </ol>
                                <article class="message is-info">
                                    <div class="message-body">
                                        I suggest to place the app in a sub directory of its access folder and block direct access to that sub directory.
                                    </div>
                                </article>
                            </dd>
                        </dl>
                        <dl>
                            <dt><h5>How can i setup the app on nginx ?</h5></dt>
                            <dd>Please refer to the <a href="https://laravel.com/docs/5.5/deployment#nginx" target="_blank">official laravel documentation</a>.</dd>
                        </dl>
                        <dl>
                            <dt><h5>My host doesn't allow to run <code>php artisan schedule:run</code>. What can i do ?</h5></dt>
                            <dd>
                                <ol>
                                    <li>Open app settings and set a secure token to execute scheduled commands externally.</li>
                                    <li>Setup a cron job with an app url to <code>scheduler/run</code>, ex:
                                        <br>
                                        <code>http://example.com/scheduler/run?key=mysecretkey</code>
                                    </li>
                                </ol>
                            </dd>
                        </dl>
                        <dl>
                            <dt><h5>How can i change the app configuration after installation ?</h5></dt>
                            <dd>
                                During the installation the configuration is cached for performance. However you can edit it manually.
                                Open the file <code>config.php</code> in <code>bootstrap/cache/</code> and edit what you need.
                            </dd>
                        </dl>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="development" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#development">#</a> Development
                    </h3>
                    <div class="content">
                        <p>
                            If you want to modify the app functionalities, you can use the development version inside <strong>development.zip</strong>.
                            <br>
                            The app uses <a href="https://laravel.com/" target="_blank">Laravel</a> for backend,
                            <a href="https://vuejs.org/" target="_blank">Vuejs</a> as javascript framework and
                            <a href="https://bulma.io/" target="_blank">Bulma</a> as css frontend framework.
                        </p>
                    </div>
                </section>

                <hr>

                <section>
                    <h3 id="changelog" class="title is-4 is-spaced bd-anchor-title">
                        <a class="bd-anchor-link" href="#changelog">#</a> Changelog
                    </h3>
                    <div class="content">
                        <pre>
Version 1.0.5

- UI improvements
- Fixed bug preventing to delete backup from certain destinations
- Fixed bug blocking connection with databases due to password with special characters
- Added the possibility to change the task token
- Task execution and cleanup functions are available as artisan console commands
                        </pre>
                        <pre>
Version 1.0.4

- Design and ui improvements
- Added activities logging
- Added table filters
- Improved user profile
                        </pre>
                        <pre>
Version 1.0.3

- Improved files backup speed
- Fixed bug preventing to set new memory limit based on settings
- Added possibility to use shell commands to backup files
- Added a basic user profile
                        </pre>
                        <pre>
Version 1.0.2

- Added possibility to choose compression type for the task.
- Added cleanup for unused temporary backup folders.
- Converted logo to svg.
                        </pre>
                        <pre>
Version 1.0.1

- UI fixes and improvements
- Update process improvements
                        </pre>
                    </div>
                </section>

            </div>
        </div>
    </div>
</section>

<footer class="footer">
    <div class="content has-text-centered">
        &copy;DBSystem, Manrix
    </div>
</footer>

<script>
    // https://stackoverflow.com/a/7717572/1838482
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();

            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
</script>
</body>
</html>